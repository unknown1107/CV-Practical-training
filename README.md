# è§†è§‰å®è®­å°ç»„ å°ç»„ä½œä¸š
ç»„é•¿ï¼šé»„äº®

ç»„å‘˜ï¼šæè‚–æ´‹ï¼Œå­™è´ºï¼Œå†‰é‘«å¹³ï¼Œé«˜åº†ï¼Œé˜³æ¶µå®‡

***

å°ç»„åˆ†å·¥

1. **æ¨¡å‹è®­ç»ƒ**
   - **è´Ÿè´£äºº**: é»„äº®ï¼ˆç»„é•¿ï¼‰
   - **ä»»åŠ¡æè¿°**: è´Ÿè´£æ¨¡å‹çš„è®­ç»ƒå·¥ä½œï¼Œå¹¶ç›‘ç£å’Œåè°ƒæ•´ä¸ªé¡¹ç›®å¼€å‘è¿‡ç¨‹ã€‚ç¡®ä¿å›¢é˜Ÿåœ¨é¢„å®šæ—¶é—´å†…å®Œæˆä»»åŠ¡ï¼ŒåŠæ—¶è§£å†³è®­ç»ƒä¸­é‡åˆ°çš„é—®é¢˜ã€‚
   - **å…·ä½“ä»»åŠ¡**:
     - **åŠ è½½é¢„è®­ç»ƒæ¨¡å‹**: åŠ è½½ YOLOv8 çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¹¶é…ç½®è®­ç»ƒè„šæœ¬ã€‚
     - **è®­ç»ƒå‚æ•°è®¾ç½®**: è®¾ç½®å…³é”®è®­ç»ƒå‚æ•°ï¼ŒåŒ…æ‹¬ `BATCH_SIZE`ã€`epochs`ã€å­¦ä¹ ç‡ç­‰ã€‚
     - **è®­ç»ƒè¿‡ç¨‹ç›‘æ§**: ç›‘æ§è®­ç»ƒè¿›åº¦ï¼Œè®°å½•æ¯ä¸ª Epoch çš„æ€§èƒ½æŒ‡æ ‡ï¼ˆå¦‚æŸå¤±å€¼ã€mAPã€ç²¾åº¦ã€å¬å›ç‡ï¼‰ã€‚
     - **æ˜¾å­˜å ç”¨è®°å½•**: ç›‘æ§å¹¶è®°å½•æ˜¾å­˜å ç”¨æƒ…å†µï¼Œç¡®ä¿è®­ç»ƒè¿‡ç¨‹ä¸­ç¡¬ä»¶èµ„æºçš„åˆç†åˆ©ç”¨ã€‚
     - **è®­ç»ƒæ—¥å¿—ç»´æŠ¤**: è®°å½•è¯¦ç»†çš„è®­ç»ƒæ—¥å¿—ï¼ŒåŒ…å«å‚æ•°è®¾ç½®ã€æ€§èƒ½æŒ‡æ ‡ã€å¼‚å¸¸å¤„ç†ç­‰ï¼Œç¡®ä¿å®éªŒå¯é‡å¤æ€§ã€‚

2. **é¡¹ç›®é…ç½®**
   - **è´Ÿè´£äºº**: å­™è´º
   - **ä»»åŠ¡æè¿°**: è´Ÿè´£é¡¹ç›®çš„ç¯å¢ƒæ­å»ºå’Œä¾èµ–é…ç½®ï¼Œç¡®ä¿å¼€å‘ç¯å¢ƒçš„ç¨³å®šæ€§å’Œå¯ç§»æ¤æ€§ã€‚ç¡®ä¿æ‰€æœ‰æˆå‘˜çš„å¼€å‘ç¯å¢ƒä¸€è‡´ï¼Œå‡å°‘ç¯å¢ƒé…ç½®å¯¹é¡¹ç›®å¼€å‘çš„å½±å“ã€‚
   - **å…·ä½“ä»»åŠ¡**:
     - **å®‰è£… `conda`**: åœ¨ `Linux` å’Œ `Windows` ç³»ç»Ÿä¸Šå®‰è£… `conda`ã€‚
     - **åˆ›å»ºå¼€å‘ç¯å¢ƒ**: åˆ›å»º `conda` ç¯å¢ƒå¹¶å®‰è£… `pytorch`ã€`ultralytics YOLOv8` ä»¥åŠå…¶ä»–æ‰€éœ€çš„ Python åº“ã€‚
     - **ä¾èµ–é…ç½®**: ç¼–å†™ä¸€é”®å®‰è£…ä¾èµ–çš„è„šæœ¬ï¼Œç¡®ä¿ç¯å¢ƒé…ç½®çš„é«˜æ•ˆæ€§ã€‚
     - **æ–‡æ¡£æ’°å†™**: ç¼–å†™ç¯å¢ƒé…ç½®æ–‡æ¡£ï¼Œè¯¦ç»†è®°å½•æ¯ä¸€æ­¥æ“ä½œï¼Œç¡®ä¿å…¶ä»–æˆå‘˜èƒ½é¡ºåˆ©æ­å»ºç¯å¢ƒã€‚
     - **é—®é¢˜æ’æŸ¥**: è§£å†³æˆå‘˜åœ¨ç¯å¢ƒé…ç½®è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œç¡®ä¿ç¯å¢ƒæ­£å¸¸è¿è¡Œã€‚

3. **æ•°æ®é›†åˆ¶ä½œ**
   - **è´Ÿè´£äºº**: æè‚–æ´‹ã€å†‰é‘«å¹³
   - **ä»»åŠ¡æè¿°**: è´Ÿè´£æ•°æ®é›†çš„æ”¶é›†ã€å¤„ç†å’Œæ ‡æ³¨å·¥ä½œï¼Œç¡®ä¿æ•°æ®é›†çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§ã€‚åˆ†å·¥åˆä½œï¼Œé«˜æ•ˆå®Œæˆæ•°æ®é›†çš„åˆ¶ä½œã€‚
   - **å…·ä½“ä»»åŠ¡**:
     - **æ•°æ®é›†æ”¶é›†**: æ”¶é›†ç”µåŠ¨è½¦ä½©æˆ´å¤´ç›”æ£€æµ‹æ•°æ®é›†ï¼ˆTWHDï¼‰ï¼Œå¹¶æ‰©å±•æ•°æ®é›†ä»¥æé«˜æ¨¡å‹æ³›åŒ–èƒ½åŠ›ã€‚
     - **æ•°æ®æ ‡æ³¨**: ä½¿ç”¨ `labelimg` å·¥å…·å¯¹æ•°æ®é›†è¿›è¡Œè¯¦ç»†æ ‡æ³¨ï¼Œç¡®ä¿æ ‡æ³¨çš„ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§ã€‚
     - **æ•°æ®é›†åˆ’åˆ†**: æŒ‰ç…§æ ‡å‡†æµç¨‹å°†æ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†ã€éªŒè¯é›†ã€æµ‹è¯•é›†ï¼Œä½¿ç”¨ `utils/split_train_val.py` è¿›è¡Œåˆ’åˆ†ã€‚
     - **æ ‡æ³¨æ–‡ä»¶è½¬æ¢**: å°† XML æ ¼å¼çš„æ ‡æ³¨æ–‡ä»¶è½¬æ¢ä¸º YOLO æ‰€éœ€çš„ TXT æ ¼å¼ï¼Œè¿è¡Œ `utils/voc_label.py` å®Œæˆè½¬æ¢ã€‚
     - **æ•°æ®å¢å¼º**: è¿›è¡Œæ•°æ®å¢å¼ºæ“ä½œï¼ˆå¦‚ç¿»è½¬ã€æ—‹è½¬ã€äº®åº¦è°ƒæ•´ç­‰ï¼‰ï¼Œä»¥æå‡æ¨¡å‹çš„é²æ£’æ€§ã€‚
     - **æ•°æ®é›†éªŒè¯**: éªŒè¯æ•°æ®é›†çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œç¡®ä¿æ•°æ®é›†å‡†å¤‡æ— è¯¯ã€‚

4. **ç»“æœä¸æ£€éªŒ**
   - **è´Ÿè´£äºº**: é«˜åº†
   - **ä»»åŠ¡æè¿°**: è´Ÿè´£æ¨¡å‹çš„éªŒè¯ä¸é¢„æµ‹å·¥ä½œï¼Œç¡®ä¿æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„è¡¨ç°è¾¾æ ‡ã€‚æ·±å…¥åˆ†ææ¨¡å‹çš„è¾“å‡ºç»“æœï¼Œæå‡ºè°ƒæ•´å»ºè®®ä»¥ä¼˜åŒ–æ¨¡å‹è¡¨ç°ã€‚
   - **å…·ä½“ä»»åŠ¡**:
     - **æ¨¡å‹éªŒè¯**: ä½¿ç”¨éªŒè¯é›†å¯¹æ¨¡å‹è¿›è¡ŒéªŒè¯ï¼Œè®°å½•éªŒè¯æŸå¤±ã€mAPç­‰æŒ‡æ ‡ï¼Œä¸åŸå§‹æ ‡ç­¾è¿›è¡Œå¯¹æ¯”åˆ†æã€‚
     - **ç»“æœåˆ†æ**: æ ¹æ®éªŒè¯ç»“æœï¼Œåˆ†ææ¨¡å‹çš„å¼ºé¡¹å’Œå¼±é¡¹ï¼Œè¯†åˆ«éœ€è¦è°ƒæ•´çš„éƒ¨åˆ†ã€‚
     - **æ¨¡å‹è°ƒæ•´**: æ ¹æ®åˆ†æç»“æœï¼Œå¯¹è®­ç»ƒå‚æ•°æˆ–æ¨¡å‹æ¶æ„è¿›è¡Œè°ƒæ•´ï¼Œé‡æ–°è®­ç»ƒæ¨¡å‹ä»¥æé«˜æ€§èƒ½ã€‚
     - **é¢„æµ‹ä»»åŠ¡**: å¤„ç†æµ‹è¯•å›¾ç‰‡å’Œè§†é¢‘ï¼Œç”Ÿæˆè®­ç»ƒåçš„é¢„æµ‹ç»“æœã€‚
     - **ç»“æœè®°å½•**: è®°å½•é¢„æµ‹ç»“æœï¼Œç”Ÿæˆè¯¦ç»†çš„å¯¹æ¯”æŠ¥å‘Šï¼Œè¯„ä¼°æ¨¡å‹çš„å®é™…åº”ç”¨æ•ˆæœã€‚

5. **å±•ç¤ºä¸æŠ¥å‘Š**
   - **è´Ÿè´£äºº**: é˜³æ¶µå®‡
   - **ä»»åŠ¡æè¿°**: è´Ÿè´£é¡¹ç›®æœ€ç»ˆæˆæœçš„å±•ç¤ºï¼ŒåŒ…æ‹¬ç»“æœå¯è§†åŒ–å’ŒæŠ¥å‘Šç¼–å†™ã€‚ç¡®ä¿ç»“æœå±•ç¤ºçš„æ¸…æ™°æ€§å’Œä¸“ä¸šæ€§ï¼Œä»¥ä¾¿æ¸…æ¥šåœ°ä¼ è¾¾é¡¹ç›®æˆæœã€‚
   - **å…·ä½“ä»»åŠ¡**:
     - **ç»“æœè§†é¢‘åˆ¶ä½œ**: åˆ¶ä½œè®­ç»ƒå‰åçš„è§†é¢‘å¯¹æ¯”ï¼Œå±•ç¤ºæ¨¡å‹çš„å®é™…åº”ç”¨æ•ˆæœã€‚
     - **å›¾ç‰‡å±•ç¤º**: ç”Ÿæˆé¢„æµ‹ç»“æœçš„å›¾ç‰‡å±•ç¤ºï¼ŒåŒ…æ‹¬å¯¹æ¯”åŸå›¾ä¸é¢„æµ‹å›¾ã€‚
     - **æŠ¥å‘Šç¼–å†™**: ç¼–å†™è¯¦ç»†çš„é¡¹ç›®æŠ¥å‘Šï¼Œå†…å®¹æ¶µç›–é¡¹ç›®èƒŒæ™¯ã€æ–¹æ³•ã€ç»“æœåˆ†æã€ç»“è®ºåŠæœªæ¥å·¥ä½œå±•æœ›ã€‚
     - **pptåˆ¶ä½œ**: åˆ¶ä½œé¡¹ç›®æ¼”ç¤ºç”¨çš„å¹»ç¯ç‰‡ï¼Œæ–¹ä¾¿åœ¨æ±‡æŠ¥æˆ–å±•ç¤ºæ—¶ä½¿ç”¨ã€‚
     - **åé¦ˆæ”¶é›†**: æ”¶é›†å…¶ä»–æˆå‘˜å¯¹ç»“æœå±•ç¤ºå’ŒæŠ¥å‘Šå†…å®¹çš„åé¦ˆï¼Œè¿›è¡Œæœ€ç»ˆçš„ä¿®æ”¹å’Œå®Œå–„ã€‚



## 1. å®‰è£…ç¯å¢ƒ

å®‰è£…`conda`

> [linux](https://repo.anaconda.com/archive/Anaconda3-2024.06-1-Linux-x86_64.sh)
>
> [windows](https://repo.anaconda.com/archive/Anaconda3-2024.06-1-Linux-x86_64.sh)

åˆ›å»º`conda`ç¯å¢ƒ

> ```shell
> conda create -n yolov8 python=3.8
> conda activate yolov8
> ```

ä¸€é”®å®‰è£…ä¾èµ–

> ```shell
> conda install -c pytorch -c nvidia -c conda-forge pytorch torchvision pytorch-cuda=11.8 ultralytics
> ```

## 2. åˆ¶ä½œæ•°æ®é›†

ä½¿ç”¨å¼€æºæ•°æ®é›†[ç”µåŠ¨è½¦ä½©æˆ´å¤´ç›”æ£€æµ‹æ•°æ®é›†ï¼ˆTWHDï¼‰](https://pan.baidu.com/share/init?surl=o9I4N4lORFGPD7ETm7C9_w&pwd=9xsz)

**TODO** è‡ªå·±åˆ¶ä½œå¹¶ä¸”æ ‡è®°æ•°æ®é›†

***

`dataset`æ•°æ®é›†ç›®å½•

> * `Annotations`æ–‡ä»¶å¤¹ï¼šç”¨æ¥å­˜æ”¾ä½¿ç”¨`labelimg`ç»™æ¯å¼ å›¾ç‰‡æ ‡æ³¨åçš„xmlæ–‡ä»¶ã€‚
> * `Images`æ–‡ä»¶å¤¹ï¼šç”¨æ¥å­˜æ”¾åŸå§‹çš„éœ€è¦è®­ç»ƒçš„æ•°æ®é›†å›¾ç‰‡ï¼Œå›¾ç‰‡æ ¼å¼ä¸ºjpgæ ¼å¼ã€‚
> * `ImageSets`æ–‡ä»¶å¤¹ï¼šç”¨æ¥å­˜æ”¾å°†æ•°æ®é›†åˆ’åˆ†åçš„ç”¨äº**è®­ç»ƒ**ã€**éªŒè¯**ã€**æµ‹è¯•**çš„æ–‡ä»¶ã€‚
> * `Labels`æ–‡ä»¶å¤¹ï¼šç”¨æ¥å­˜æ”¾å°†xmlæ ¼å¼çš„æ ‡æ³¨æ–‡ä»¶è½¬æ¢åçš„txtæ ¼å¼çš„æ ‡æ³¨æ–‡ä»¶ã€‚

è¿è¡Œ `utils/split_train_val.py` å’Œ `utils/voc_label.py` è¿›è¡Œæ•°æ®é›†åˆ’åˆ†

åˆ’åˆ†ä¹‹åçš„ç»“æœ

![Clip_2024-09-03_01-55-06](https://my-img-typora.oss-cn-chengdu.aliyuncs.com/img/Clip_2024-09-03_01-55-06.png)

## 3. è®­ç»ƒ

> è®­ç»ƒç¯å¢ƒ `Ultralytics YOLOv8.2.86 ğŸš€ Python-3.8.19 torch-2.4.0 CUDA:0 (NVIDIA A10, 22513MiB)`
> 
> åœ¨ `BATCH_SIZE=32` çš„æƒ…å†µä¸‹ `100 epochs completed in 4.229 hours.` 

`train.ipynb`

```python
from ultralytics import YOLO

# Load a model
model = YOLO("model/yolov8n.pt")  # load a pretrained model (recommended for training)

# Train the model
results = model.train(data="wheat.yaml", epochs=100ï¼Œ batch=32)
```

### å‚æ•°å’ŒåŠ è½½

![image-20240903020007165](https://my-img-typora.oss-cn-chengdu.aliyuncs.com/img/image-20240903020007165.png)

### æ˜¾å­˜å ç”¨æƒ…å†µ

![image-20240903020151661](https://my-img-typora.oss-cn-chengdu.aliyuncs.com/img/image-20240903020151661.png)

### è®­ç»ƒè¿‡ç¨‹

![image-20240903020031128](https://my-img-typora.oss-cn-chengdu.aliyuncs.com/img/image-20240903020031128.png)

![image-20240903020053988](https://my-img-typora.oss-cn-chengdu.aliyuncs.com/img/image-20240903020053988.png)

![image-20240903020605914](https://my-img-typora.oss-cn-chengdu.aliyuncs.com/img/image-20240903020605914.png)

### VALIDATE

![image-20240903020123464](https://my-img-typora.oss-cn-chengdu.aliyuncs.com/img/image-20240903020123464.png)

è¿›è¡ŒéªŒè¯çš„åŸæ ‡ç­¾å’Œé¢„æµ‹å¯¹æ¯”

![image-20240903020403830](https://my-img-typora.oss-cn-chengdu.aliyuncs.com/img/image-20240903020403830.png)

![image-20240903020423372](https://my-img-typora.oss-cn-chengdu.aliyuncs.com/img/image-20240903020423372.png)

![image-20240903020439723](https://my-img-typora.oss-cn-chengdu.aliyuncs.com/img/image-20240903020439723.png)

## 4.è®­ç»ƒç»“æœ

![results](https://my-img-typora.oss-cn-chengdu.aliyuncs.com/img/results.png)

## 5. é¢„æµ‹ç»“æœ

### å›¾ç‰‡

<center class="half">
    <img src="test/images/origin/test1.jpg" width="350"/>
    <img src="test/images/pred/test1.jpg" width="350"/>
</center>

<center class="half">
    <img src="test/images/origin/test2.png" width="350"/>
    <img src="test/images/pred/test2.png" width="350"/>
</center>

<center class="half">
    <img src="test/images/origin/test3.png" width="350"/>
    <img src="test/images/pred/test3.png" width="350"/>
</center>

<center class="half">
    <img src="test/images/origin/test4.png" width="350"/>
    <img src="test/images/pred/test4.png" width="350"/>
</center>

### è§†é¢‘

åŸè§†é¢‘ï¼š`test/videos/origin/1.mp4`

è®­ç»ƒä¹‹åçš„è§†é¢‘ï¼š`test/videos/pred/1_full.mp4`ï¼Œ `test/videos/pred/1_only_helmet.mp4`